# Ручная настройка базы данных в pgAdmin 4

## Быстрая инструкция

### Шаг 1: Откройте pgAdmin 4

1. Запустите pgAdmin 4
2. Подключитесь к серверу PostgreSQL
3. Разверните базу данных `tablebook`

### Шаг 2: Откройте Query Tool

1. Правой кнопкой мыши на базе данных `tablebook`
2. Выберите **"Tools"** → **"Query Tool"**
3. Или нажмите `Alt+Shift+Q`

### Шаг 3: Выполните SQL скрипт

1. Откройте файл `database_schema.sql` в любом текстовом редакторе
2. Скопируйте **весь** содержимое файла
3. Вставьте в Query Tool в pgAdmin
4. Нажмите кнопку **"Execute"** (▶) или `F5`

### Шаг 4: Проверка

После выполнения скрипта:

1. Обновите дерево объектов (правой кнопкой на `tablebook` → **"Refresh"**)
2. Разверните **"Schemas"** → **"public"** → **"Tables"**
3. Вы должны увидеть 3 таблицы:
   - `users` - пользователи
   - `restaurants` - рестораны  
   - `bookings` - бронирования

### Шаг 5: Проверка данных

Выполните в Query Tool:

```sql
-- Проверка пользователей
SELECT * FROM users;

-- Проверка ресторанов
SELECT * FROM restaurants;

-- Проверка количества записей
SELECT 
    (SELECT COUNT(*) FROM users) as users_count,
    (SELECT COUNT(*) FROM restaurants) as restaurants_count,
    (SELECT COUNT(*) FROM bookings) as bookings_count;
```

## Что создаст скрипт:

✅ **Таблицы:**
- `users` - пользователи системы
- `restaurants` - рестораны
- `bookings` - бронирования

✅ **Индексы:**
- Для быстрого поиска по email, городу, кухне и т.д.

✅ **Внешние ключи:**
- Связь bookings → restaurants
- Связь bookings → users

✅ **Триггеры:**
- Автоматическое обновление `updated_at` при изменении записей

✅ **Тестовые данные:**
- 2 пользователя (admin и user)
- 10 ресторанов

## Важно!

**Пароли в базе данных:**
- Пароли в SQL скрипте - это примеры (зашифрованные)
- Для реальной работы нужно использовать BCrypt хеширование
- Приложение Spring Boot автоматически хеширует пароли при регистрации

**Для тестирования:**
- Используйте функции регистрации/входа через API
- Или создайте пользователей через приложение

## Если что-то пошло не так:

1. **Ошибка "table already exists":**
   - Удалите таблицы вручную или используйте `DROP TABLE` перед созданием

2. **Ошибка прав доступа:**
   - Убедитесь, что вы подключены как пользователь `postgres`

3. **Очистка базы данных:**
   ```sql
   DROP TABLE IF EXISTS bookings CASCADE;
   DROP TABLE IF EXISTS restaurants CASCADE;
   DROP TABLE IF EXISTS users CASCADE;
   ```
   Затем выполните скрипт заново.

## После создания таблиц:

1. Запустите приложение Spring Boot
2. Приложение подключится к существующим таблицам
3. Используйте `spring.jpa.hibernate.ddl-auto=validate` вместо `update` в `application.properties` (чтобы не изменять структуру)


